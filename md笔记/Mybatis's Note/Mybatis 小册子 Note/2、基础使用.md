#åŸºç¡€ä½¿ç”¨



åˆå§‹è¯æ•°æ®åº“è¯­å¥

```sql
create table users
(
    id         numeric,
    name       varchar(32),
    class_no   numeric,
    class_name varchar(32)
) ;

INSERT INTO demo.users (id, name, class_no, class_name) VALUES (1, 'å¼ ä¸‰', 51, 'äº”å¹´ä¸€ç­');
INSERT INTO demo.users (id, name, class_no, class_name) VALUES (2, 'æå››', 51, 'äº”å¹´ä¸€ç­');
INSERT INTO demo.users (id, name, class_no, class_name) VALUES (3, 'ç‹äº”', 61, 'å…­å¹´ä¸€ç­');
```

è¿›è¡Œå®ä½“ç±»ç¼–å†™ï¼Œå®šä¹‰ä¸€ä¸ªç”¨æˆ·ç±»

```java
public class User {
	int id;
	String name;
	int classNo;
	String className;

	public User() {
	}

	public User(int id, String name, int classNo, String className) {
		this.id = id;
		this.name = name;
		this.classNo = classNo;
		this.className = className;
	}

	public int getId() {
		return id;
	}

	public void setId(int id) {
		this.id = id;
	}

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}

	public int getClassNo() {
		return classNo;
	}

	public void setClassNo(int classNo) {
		this.classNo = classNo;
	}

	public String getClassName() {
		return className;
	}

	public void setClassName(String className) {
		this.className = className;
	}
}
```



###åŸºäºåŸå§‹Daoå¼€å‘

å®ç°åŠŸèƒ½ç±»ä»£ç 

```java
public class UserMapperImpl implements UserMapper {

	private final SqlSessionFactory factory;

	public UserMapperImpl(SqlSessionFactory factory) {
		this.factory = factory;
	}

	@Override
	public User selectUserById(int id) {
		try (SqlSession session = factory.openSession()) {
			return session.selectOne("userMapper.selectUserById", id);
		}
	}
}
```



åŒæ—¶ï¼Œéœ€è¦å¯¹mapperæ–‡ä»¶è¿›è¡ŒæŒ‡å®š

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="userMapper">
    <select id="selectUserById" resultType="com.example.mybatis.User">
        select * from users  where id = #{id}
    </select>
</mapper>
```



Appå…¥å£ä»£ç 

```java
public class App {

	public static void main(String[] args) throws IOException {

		String resource = "mybatis-3-config.xml";
		InputStream inputStream = Resources.getResourceAsStream(resource);
		SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
		UserMapperImpl mapper = new UserMapperImpl(sqlSessionFactory);
		System.out.println(mapper.selectUserById(1));
	}
}
```





###åŸºäºMapperåŠ¨æ€ä»£ç†çš„å¼€å‘æ–¹å¼

åŸºäºä»£ç†çš„æ¥å£ç±»

```java
public interface UserMapper {

	User selectUserByid(int id);

}
```



å¯¹åº”ä»£ç†ç±»çš„mapperæ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatis.dao.UserMapper">
    <select id="selectUserByid" resultType="com.example.mybatis.User">
        select * from users  where id = #{id}
    </select>
</mapper>
```



Appå…¥å£çš„ä»£ç 

```java
public class App {

	public static void main(String[] args) throws IOException {

		String resource = "mybatis-3-config.xml";
		InputStream inputStream = Resources.getResourceAsStream(resource);
		SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);

		try (SqlSession session = sqlSessionFactory.openSession()) {
			UserMapper mapper = session.getMapper(UserMapper.class);
			User user = mapper.selectUserByid(1);
			System.out.println(user.toString());
		}
	}
}
```





### å»¶è¿ŸåŠ è½½ï¼ˆå…³è”æŸ¥è¯¢ï¼‰

sqlå‡†å¤‡é˜¶æ®µï¼Œæ–°å¢ä¸€ä¸ªç­çº§çš„è¡¨ï¼ˆç”±äºå®æˆ˜å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰å†—ä½™å­—æ®µçš„æ“ä½œï¼Œå¤§å®¶ä¸è¦çº ç»“ï¼‰

```sql
create table classes
(
    class_no numeric,
    class_name varchar(32)
);

INSERT INTO demo.classes (class_no, class_name) VALUES (51, 'äº”å¹´ä¸€ç­');
INSERT INTO demo.classes (class_no, class_name) VALUES (51, 'äº”å¹´ä¸€ç­');
INSERT INTO demo.classes (class_no, class_name) VALUES (61, 'å…­å¹´ä¸€ç­');
```



é€šè¿‡ä¿®æ”¹`resultMap`æ¥å®ç°å»¶è¿ŸåŠ è½½

ä¿®æ”¹åçš„Mapperä¸ºï¼š

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatis.dao.UserMapper">

    <resultMap id="UserLazyMap" type="com.example.mybatis.User">
        <id property="id" column="id" javaType="int"/>
        <result property="name" column="name" javaType="string"/>
        <result property="classNo" column="class_no" javaType="int"/>
        <result property="className" column="class_name" javaType="string"/>
        <association property="userClass"
                     javaType="com.example.mybatis.UserClass"
                     select="com.example.mybatis.dao.UserClassMapper.selectUserClassByClassNo"
                     column="class_no">
        </association>

    </resultMap>

    <select id="selectUserById" resultMap="UserLazyMap">
        select *
        from users
        where id = #{id}
    </select>
</mapper>
```



åŒæ—¶å¢åŠ äº†å¹´çº§æŸ¥è¯¢çš„ - å®ä½“ç±»ï¼ŒDaoå’ŒMapper

Entity:

```java
package com.example.mybatis;

public class UserClass {

	int classNo;
	String className;

	public UserClass() {
	}

	public UserClass(int classNo, String className) {
		this.classNo = classNo;
		this.className = className;
	}

	public int getClassNo() {
		return classNo;
	}

	public void setClassNo(int classNo) {
		this.classNo = classNo;
	}

	public String getClassName() {
		return className;
	}

	public void setClassName(String className) {
		this.className = className;
	}

	@Override
	public String toString() {
		return "UserClass{" +
				"classNo=" + classNo +
				", className='" + className + '\'' +
				'}';
	}
}

```



Dao:

```java
public interface UserClassMapper {

	UserClass selectUserClassByClassNo(int classNo);

}
```


Mapper.xml:

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mybatis.dao.UserClassMapper">

    <resultMap id="UserClassMap" type="com.example.mybatis.UserClass">
        <result property="classNo" column="class_no" javaType="int"/>
        <result property="className" column="class_name" javaType="string"/>
    </resultMap>

    <select id="selectUserClassByClassNo" resultMap="UserClassMap">
        select *
        from classes
        where class_no = #{classNo}
    </select>
</mapper>
```



é€šè¿‡æŸ¥çœ‹æ‰“å°çš„æ—¥å¿—ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œè¯­å¥çš„é¡ºåº

```log
Logging initialized using 'class org.apache.ibatis.logging.stdout.StdOutImpl' adapter.
PooledDataSource forcefully closed/removed all connections.
PooledDataSource forcefully closed/removed all connections.
PooledDataSource forcefully closed/removed all connections.
PooledDataSource forcefully closed/removed all connections.
Opening JDBC Connection
Loading class `com.mysql.jdbc.Driver'. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver'. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.
Created connection 1329315688.
Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4f3bbf68]
==>  Preparing: select * from users where id = ?
==> Parameters: 1(Integer)
<==    Columns: id, name, class_no, class_name
<==        Row: 1, å¼ ä¸‰, 51, äº”å¹´ä¸€ç­
====>  Preparing: select * from classes where class_no = ?
====> Parameters: 51(BigDecimal)
<====    Columns: class_no, class_name
<====        Row: 51, äº”å¹´çº§ä¸€ç­
<====      Total: 1
<==      Total: 1
User{id=1, name='å¼ ä¸‰', classNo=51, className='äº”å¹´ä¸€ç­', userClass=UserClass{classNo=51, className='äº”å¹´çº§ä¸€ç­'}}
Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4f3bbf68]
Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4f3bbf68]
Returned connection 1329315688 to pool.

Process finished with exit code 0
```



âš ï¸

å½“ä½¿ç”¨å…³è”æŸ¥è¯¢æ—¶ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢ï¼Œå»¶è¿ŸåŠ è½½çš„å†…å®¹ä¼šè¢«ç¼“å­˜ï¼›

ï¼ˆå˜ç›¸å­˜åœ¨äº‹åŠ¡ä¸ä¸€è‡´çš„é—®é¢˜ï¼š

* Userä¿¡æ¯æŸ¥è¯¢å®Œæ¯•ï¼Œæ­¤æ—¶Classä¿¡æ¯è¢«æ›´æ–°ï¼›åˆ™ä¼šæŸ¥è¯¢å‡ºæœ€æ–°çš„æƒ…å†µã€‚

* Userä¿¡æ¯æŸ¥è¯¢å®Œæ¯•ï¼ŒClassä¿¡æ¯æŸ¥è¯¢å®Œæ¯•ï¼ŒClassè¢«æ›´æ–°ï¼Œåˆä½¿ç”¨äº†ç¼“å­˜çš„Classä¿¡æ¯ï¼›ä»è€Œå¯¼è‡´äº†è„è¯»

ï¼‰



ğŸ‰‘ï¸

***åŸåˆ™*** ï¼š ä¸å»ºè®®ä½¿ç”¨`association` å…³è”æ•°æ®æ ‡ç­¾è¿›è¡ŒæŸ¥è¯¢ã€‚

**å¦‚æœ **ï¼Œå­˜åœ¨æ˜ç¡®æŒ‡å®šæ¡ä»¶çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œé¢ï¼Œè¯¥æ¡ä»¶çš„å…³è”å¯¹è±¡å”¯ä¸€ï¼›

* å¯ä»¥é€šè¿‡ä½¿ç”¨`association`å¢åŠ ä»£ç å¯è¯»æ€§ï¼ˆæ— éœ€æ˜æ˜¾çš„å£°æ˜å¾ªç¯ï¼Œè¿›è¡Œèµ‹å€¼ï¼‰ã€‚



**ä¾‹å¦‚** ï¼šæŸ¥è¯¢äº”å¹´çº§ä¸€ç­çš„æ‰€æœ‰åŒå­¦

â€‹				æŒ‡å®šæ¡ä»¶ï¼š`class_no = '51'`