# 全局配置文件 详情&解析

###properties-属性

```xml
    <properties>
        <property name="" value=""/>
    </properties>
```



它的作用是**定义全局配置变量**，并且它可以**加载外部化的 properties 配置文件**。下面我们来简单演示一下 properties 的使用。

试着提取一下下面数据源的几个配置：

```xml
	<properties resource="config.properties">
        <property name="driver" value="com.mysql.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost:3306/demo"/>
        <property name="user" value="root"/>
        <property name="password" value="12345678"/>
    </properties>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${user}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
    </environments>
```

下面的数据源在引用配置时，只需要使用 `${}` 的表达式引用即可。



####加载外部化配置文件

`<properties>` 标签是可以直接声明 resource 或者 url 来加载外部化配置文件的。

先把 config.properties 文件编写出来：

```properties
jdbc.driverClassName=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/deno
```

然后，使用 `<properties>` 标签把这个 properties 文件加载进来即可：

```xml
<properties resource="config.properties">
        <property name="user" value="root"/>
        <property name="password" value="12345678"/>
    </properties>
    <settings>
        <setting name="logImpl" value="STDOUT_LOGGING"/>
    </settings>
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED">
                <property name="driver" value="${driver}"/>
                <property name="url" value="${url}"/>
                <property name="username" value="${user}"/>
                <property name="password" value="${password}"/>
            </dataSource>
        </environment>
    </environments>
```

⚠️

`properties` 中的属性 **resource 跟 url 是互斥的，二者只能取其一**，如果两个都定义，MyBatis 都没办法初始化，会抛出异常！所以我们只需要声明一个属性即可。



#### 加载多个外部化配置文件

真的需要一次性加载多个外部化配置文件，使用 xml 配置的方式是无法实现的。

借助**`Properties` 这个类是可以加载多个 properties 文件到一个对象中**的方式

```java
public class LoadPropertiesApplication {
    
    public static void main(String[] args) throws Exception {
        InputStream xml = Resources.getResourceAsStream("mybatis-config.xml");
        // 使用Properties的API加载这些properties文件
        Properties properties = new Properties();
        properties.load(Resources.getResourceAsStream("jdbc1.properties"));
        properties.load(Resources.getResourceAsStream("jdbc2.properties"));
        
        SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(xml, properties);
        SqlSession sqlSession = sqlSessionFactory.openSession();
        
        DepartmentMapper departmentMapper = sqlSession.getMapper(DepartmentMapper.class);
        Department department = departmentMapper.findById("18ec781fbefd727923b0d35740b177ab");
        System.out.println(department);
        System.out.println(department.getUsers());
    }
}
```



#### 配置优先级

Mybatis配置的读取属性有以下三种方式：

- 直接在 `<properties>` 中定义配置属性
- 借助 `<properties>` 的 resource / url 属性加载外部化配置文件
- 编程式加载外部化配置文件



>If a property exists in more than one of these places, MyBatis loads them in the following order:
>
>- Properties specified in the body of the properties element are read first,
>- Properties loaded from the classpath resource or url attributes of the properties element are read second, and override any duplicate properties already specified,
>- Properties passed as a method parameter are read last, and override any duplicate properties that may have been loaded from the properties body and the resource/url attributes.

官方文档的说法，MyBatis 会按照上面所述的顺序读取配置属性，而下面的属性会覆盖上面的，所以优先级的顺序就刚好与上面列举的顺序相反：

- 编程式加载的外部化配置文件
- 借助 `<properties>` 的 resource / url 属性加载的外部化配置文件
- 在 `<properties>` 中定义的配置属性



--------

### setting-配置

setting 配置，这里面提供了 MyBatis 中可供调整的所有内部配置项的全局设置。

详细可以参看<a herf="https://mybatis.org/mybatis-3/configuration.html#settings">官方配置</a>；

| 配置项                   | 描述                 | 可选值                                        | 默认值 |
| ------------------------ | -------------------- | --------------------------------------------- | ------ |
| cacheEnabled             | 全局开启二级缓存     | true / false                                  | true   |
| lazyLoadingEnabled       | 全局开启延迟加载     | true / false                                  | false  |
| mapUnderscoreToCamelCase | 驼峰命名转下划线命名 | true / false                                  | false  |
| logImpl                  | 日志提供商           | SLF4J / LOG4J / LOG4J2 /COMMONS_LOGGING / ... | (空)   |



------

###typeAliases-类型别名

typeAliases 类型别名的设置，是考虑到 mapper.xml 中我们每次写实体类的时候，都要写它们的全限定类名，太麻烦，于是 MyBatis 提供了类型别名的机制。

```xml
   <typeAliases>
        <!-- 逐个声明 -->
        <typeAlias alias="Department" type="com.linkedbear.mybatis.entity.Department"/>
        
        <!-- 包扫描
             以此法被扫描的实体类，别名为类名的首字母小写形式(类似于Bean -> bean)
        -->
        <package name="com.linkedbear.mybatis.entity"/>
    </typeAliases>
```

⚠️

> 另外，不要忘记一点，MyBatis 的别名是不区分大小写的。





------

###typeHandlers-类型处理器

typeHandlers 类型处理器，它的意义是针对一个特定的 Java 类型，或者 jdbc 类型，采用特定的处理器来处理这个类型的字段。

| 类型处理器         | javaType        | jdbcType          |
| ------------------ | --------------- | ----------------- |
| IntegerTypeHandler | Integer 、int   | int / numeric     |
| DoubleTypeHandler  | Double 、double | double / numberic |
| StringTypeHandler  | String          | varchar / char    |
| DateTypeHandler    | Date            | timestamp         |
| EnumTypeHandler    | Enum            | varchar / char    |

![TypeHandler](/Users/swk/studyTmp/Mybatis/TypeHandler.png)



一般情况下，我们只需要使用 MyBatis 内置的这些 typeHandler 就完全够用，如果实在是满足不了需求，也没关系，我们可以针对某些特定的类型，自定义 typeHandler 来处理。



#### 自定义TypeHandler

